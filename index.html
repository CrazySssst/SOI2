<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <script src="https://cdn1.lncld.net/static/js/av-mini-0.5.5.js"></script>
    <script src="lib/ext/ext-all-dev.js"></script>
    <link rel="stylesheet" href="lib/ext/resources/css/ext-all.css"/>
    <script type="text/javascript" src="lib/ext/ext-lang-zh_CN.js"></script>
    <audio src="asset/music/background.mp3" autoplay="autoplay" loop="loop"></audio>
</head>
<body style="background-image: url(asset/image/background.jpg); background-position: center; background-repeat: no-repeat;">
<!--标题-->
<div style="position:absolute;top:55%;left:50%;margin:-50px 0 0 -300px;width:600px;height:100px;">
    <h1 id="title" style="color:#ffffff; font-size:46px;text-align:center">Soul of Iron Ⅱ</h1>
</div>
<!--版本号-->
<div style="position:absolute;top:61%;left:50%;margin:-20px 0 0 -20px;width:40px;height:40px;">
    <h1 style="color:#ffffff; font-size:23px;text-align:center">V0.1</h1>
</div>
<!--登录框及按钮-->
<div style="position:absolute;top:78%;left:50%;margin:-100px 0 0 -95px;width:190px;height:200px;">
    <h3 style="color:#ffffff; font-size:10px;">昵称:</h3>
    <input type="text" id="username" autocomplete="off" style="width: 180px;height: 25px;display: inline-block;vertical-align: top;font: 15px/17px arial;padding: 0;border: 0;outline: 0;
            background: url(asset/image/search_box.png) repeat-x;"/>

    <h3 style="color:#ffffff; font-size:10px;">密码:</h3>
    <input type="password" id="password" autocomplete="off" style="width: 180px;height: 25px;display: inline-block;vertical-align: top;font: 15px/17px arial;padding: 0;border: 0;outline: 0;
            background: url(asset/image/search_box.png) repeat-x;"/>
    <br><br>

    <input type="submit" id="login" value="   登录   " onclick="login()"
           style="height: 22px;line-height: 15px;padding: 3px 20px;background-color: #2C97E8;color: #fff;display: inline-block;cursor: pointer;"/>
    <script type="text/javascript">
        function login() {
            var name = document.getElementById("username").value;
            var password = document.getElementById("password").value;
            if (name == "" || password == "")
                Ext.MessageBox.show({title: "", msg: "请输入用户名及密码哦", icon: Ext.Msg.ERROR, buttons: Ext.Msg.OK});
            else {
                AV.User.logIn(name, password, {
                    success: function (user) {
                        window.location.href = "join.html?" + user.getUsername();
                    },
                    error: function (user, error) {
                        Ext.MessageBox.show({title: "", msg: "您的用户名或密码不对哦", icon: Ext.Msg.ERROR, buttons: Ext.Msg.OK});
                    }
                });
            }
        }
    </script>

    <input type="submit" id="register" value="   注册   " onclick="register()"
           style="height: 22px;line-height: 15px;padding: 3px 20px;background-color: #2C97E8;color: #fff;display: inline-block;cursor: pointer;"/>
    <script type="text/javascript">
        function register() {
            Ext.MessageBox.prompt("玩家注册", "请您输入昵称", function (btn, text) {
                if (btn == "ok") {
                    if (text == null || text == '') {
                        Ext.MessageBox.show({title: "", msg: "不能为空哎亲", icon: Ext.Msg.ERROR, buttons: Ext.Msg.OK});
                    }
                    else {
                        var user = new AV.User();
                        user.set("username", text);
                        user.set("password", "0000");
                        user.signUp(null, {
                            success: function (user) {
                                AV.User.logIn(user.getUsername(), "0000", {
                                    success: function (user) {
                                        Ext.MessageBox.prompt("玩家注册", "请您设置密码，初始为0000", function (btn, text) {
                                            if (btn == "ok") {
                                                if (text == null || text == '') {
                                                    Ext.MessageBox.show({title: "", msg: "不设密码？那就是0000哦", icon: Ext.Msg.ERROR, buttons: Ext.Msg.OK});
                                                }
                                                else {
                                                    var user = AV.User.current();
                                                    user.setPassword(text);
                                                    user.save();
                                                    Ext.MessageBox.show({title: "", msg: "注册成功，欢迎加入SOI2", icon: Ext.Msg.INFO, buttons: Ext.Msg.OK});
                                                }
                                            }
                                        });
                                    },
                                    error: function (user, error) {
                                        // 失败了.
                                        Ext.MessageBox.show({title: "", msg: "Error: " + error.code + " " + error.message, icon: Ext.Msg.ERROR, buttons: Ext.Msg.OK});
                                    }
                                });
                            },
                            error: function (user, error) {
                                // 失败了
                                Ext.MessageBox.show({title: "", msg: "Error: " + error.code + " " + error.message, icon: Ext.Msg.ERROR, buttons: Ext.Msg.OK});
                            }
                        });
                    }
                }
            });
        }
    </script>
</div>
<!--版权声明-->
<div style="position:absolute;top:95%;left:50%;margin:-20px 0 0 -170px;width:340px;height:40px;">
    <h1 style="color:#808080; font-size:14px;text-align:center">Copyright © 2015 buaadpy. All Rights Reserved.</h1>
</div>
<!--页面启动时执行-->
<script type="text/javascript">
    document.getElementById("username").focus();
    AV.initialize("ahrxpnr9g6t01fd03iv5c8y69j5m1zo3oh3h12xoek336g2s", "uk5g0fhd8bwe0y1pe9xv55ft321yglbcctpbbbmn3160eq84");
</script>
</body>
</html>